<!DOCTYPE html><!DOCTYPE html><!DOCTYPE html><!DOCTYPE html><!DOCTYPE html>

<html lang="de">

<head><html lang="de">

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><html lang="de">

    <title>Avatar Editor - Adventskalender 2024</title>

    <style>    <meta charset="UTF-8">

        * { margin: 0; padding: 0; box-sizing: border-box; }

            <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><html lang="de"><html lang="de">

        body {

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);    <title>Avatar Editor - Adventskalender 2024</title>

            min-height: 100vh;

            padding: 0 0 100px 0;    <style>    <meta charset="UTF-8">

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

        }        * {



        .avatar-header {            margin: 0;    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><head>

            position: sticky;

            top: 0;            padding: 0;

            z-index: 100;

            background: rgba(255, 255, 255, 0.95);            box-sizing: border-box;    <title>Avatar Editor - Adventskalender 2024</title>

            backdrop-filter: blur(10px);

            border-radius: 0 0 20px 20px;        }

            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);

            padding: 20px;    <style>    <meta charset="UTF-8">    <meta charset="UTF-8">

            margin-bottom: 30px;

            transition: all 0.3s ease;        body {

        }

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);        * {

        .avatar-header.scrolled { padding: 10px 20px; }

        .avatar-header.scrolled .avatar-preview { width: 60px; height: 60px; }            min-height: 100vh;

        .avatar-header.scrolled h1 { font-size: 1.2rem; }

            padding: 0 0 100px 0;            margin: 0;    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        .avatar-header-content {

            display: flex;            margin: 0;

            align-items: center;

            gap: 20px;            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;            padding: 0;

            max-width: 1200px;

            margin: 0 auto;        }

        }

            box-sizing: border-box;    <title>Avatar Editor - Adventskalender</title>    <title>Avatar Editor - Adventskalender 2024</title>

        .avatar-info { flex: 1; }

        .editor-container {

        .avatar-header h1 {

            font-size: 1.8rem;            max-width: 1200px;        }

            margin: 0 0 5px 0;

            color: #333;            margin: 0 auto;

            transition: all 0.3s ease;

        }            padding: 20px;    <link rel="stylesheet" href="styles.css">    <link rel="stylesheet" href="avatar-editor.css">



        .score-display {        }

            display: inline-flex;

            align-items: center;        body {

            gap: 8px;

            padding: 6px 14px;        /* Sticky Avatar Preview Header */

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            border-radius: 20px;        .avatar-header {            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);    <style>    <style>

            color: white;

            font-weight: bold;            position: sticky;

        }

            top: 0;            min-height: 100vh;

        .avatar-preview {

            width: 100px;            z-index: 100;

            height: 100px;

            border-radius: 50%;            background: rgba(255, 255, 255, 0.95);            padding: 0;        .editor-container {        .avatar-3d-canvas {

            overflow: hidden;

            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);            backdrop-filter: blur(10px);

            transition: all 0.3s ease;

            background: white;            border-radius: 0 0 20px 20px;            margin: 0;

            flex-shrink: 0;

        }            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);



        .avatar-preview img { width: 100%; height: 100%; object-fit: cover; }            padding: 20px;            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;            max-width: 1200px;            border-radius: 15px;



        .action-buttons {            margin-bottom: 30px;

            position: fixed;

            bottom: 0;            transition: all 0.3s ease;            padding-bottom: 100px; /* Platz f√ºr sticky Buttons */

            left: 0;

            right: 0;        }

            z-index: 99;

            background: rgba(255, 255, 255, 0.98);        }            margin: 40px auto;            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);

            backdrop-filter: blur(10px);

            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);        .avatar-header.scrolled {

            padding: 15px 20px;

            display: flex;            padding: 10px 20px;

            gap: 15px;

            justify-content: center;        }

        }

        .editor-container {            padding: 20px;        }

        .btn {

            padding: 12px 30px;        .avatar-header.scrolled .avatar-preview {

            border: none;

            border-radius: 12px;            width: 60px;            max-width: 1200px;

            cursor: pointer;

            font-size: 1rem;            height: 60px;

            font-weight: bold;

            transition: all 0.3s;        }            margin: 0 auto;        }        

            display: flex;

            align-items: center;

            gap: 8px;

        }        .avatar-header.scrolled h1 {            padding: 20px;



        .btn-primary {            font-size: 1.2rem;

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            color: white;        }        }        .render-mode-toggle {

        }



        .btn-secondary { background: white; color: #667eea; border: 2px solid #667eea; }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }        .avatar-header-content {

        .btn:active { transform: translateY(0); }

            display: flex;

        .editor-container { max-width: 1200px; margin: 0 auto; padding: 20px; }

            align-items: center;        /* Sticky Avatar Preview Header */        .editor-header {            position: absolute;

        .style-selector, .customization-panel {

            background: white;            gap: 20px;

            border-radius: 20px;

            padding: 25px;            max-width: 1200px;        .avatar-header {

            margin-bottom: 25px;

            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);            margin: 0 auto;

        }

        }            position: sticky;            text-align: center;            top: 10px;

        .style-selector h2, .customization-panel h2 { margin: 0 0 20px 0; color: #333; }



        .style-grid {

            display: grid;        .avatar-info {            top: 0;

            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));

            gap: 15px;            flex: 1;

        }

        }            z-index: 100;            margin-bottom: 30px;            right: 10px;

        .style-card {

            background: #f8f9fa;

            border: 3px solid transparent;

            border-radius: 15px;        .avatar-header h1 {            background: rgba(255, 255, 255, 0.95);

            padding: 20px;

            text-align: center;            font-size: 1.8rem;

            cursor: pointer;

            transition: all 0.3s;            margin: 0 0 5px 0;            backdrop-filter: blur(10px);        }            background: rgba(255, 255, 255, 0.1);

            position: relative;

        }            color: #333;



        .style-card:hover:not(.locked) { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }            transition: all 0.3s ease;            border-radius: 0 0 20px 20px;

        .style-card.active { border-color: #667eea; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); }

        .style-card.locked { opacity: 0.5; cursor: not-allowed; }        }



        .lock-badge {            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);            border: 1px solid rgba(255, 255, 255, 0.2);

            position: absolute;

            top: 10px;        .score-display {

            right: 10px;

            background: #ff6b6b;            display: inline-flex;            padding: 20px;

            color: white;

            padding: 5px 10px;            align-items: center;

            border-radius: 10px;

            font-size: 0.8rem;            gap: 8px;            margin-bottom: 30px;        .editor-header h1 {            padding: 8px 16px;

        }

            padding: 6px 14px;

        .option-group {

            margin-bottom: 25px;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            transition: all 0.3s ease;

            padding-bottom: 25px;

            border-bottom: 1px solid #e0e0e0;            border-radius: 20px;

        }

            color: white;        }            font-size: 2.5rem;            border-radius: 20px;

        .option-group:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

            font-weight: bold;

        .option-header {

            display: flex;            font-size: 1rem;

            align-items: center;

            justify-content: space-between;        }

            margin-bottom: 15px;

        }        .avatar-header.scrolled {            margin-bottom: 10px;            cursor: pointer;



        .option-header h3 { margin: 0; color: #333; font-size: 1.2rem; }        .avatar-preview {



        .unlock-badge {            width: 100px;            padding: 10px 20px;

            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);

            color: #333;            height: 100px;

            padding: 5px 12px;

            border-radius: 15px;            border-radius: 50%;        }            color: var(--primary-color, #c41e3a);            color: white;

            font-size: 0.85rem;

            font-weight: bold;            overflow: hidden;

        }

            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);

        .options-grid {

            display: grid;            transition: all 0.3s ease;

            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));

            gap: 10px;            background: white;        .avatar-header.scrolled .avatar-preview {        }            font-size: 12px;

        }

            flex-shrink: 0;

        .option-item {

            aspect-ratio: 1;        }            width: 60px;

            border: 3px solid #e0e0e0;

            border-radius: 12px;

            cursor: pointer;

            transition: all 0.3s;        .avatar-preview img {            height: 60px;            transition: all 0.3s;

            display: flex;

            align-items: center;            width: 100%;

            justify-content: center;

            font-size: 0.8rem;            height: 100%;        }

            font-weight: bold;

            color: #666;            object-fit: cover;

            background: #f8f9fa;

            position: relative;        }        .score-display {            backdrop-filter: blur(10px);

            overflow: hidden;

        }



        .option-item:hover:not(.locked) { border-color: #667eea; transform: scale(1.05); }        /* Sticky Action Buttons am unteren Rand */        .avatar-header.scrolled h1 {

        .option-item.active { border-color: #667eea; background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%); color: #667eea; }

        .option-item.locked { opacity: 0.4; cursor: not-allowed; }        .action-buttons {

        .option-item.locked::after { content: 'üîí'; position: absolute; font-size: 1.5rem; }

        .option-item.color-option { border-radius: 50%; }            position: fixed;            font-size: 1.2rem;            display: inline-flex;        }



        .next-unlocks {            bottom: 0;

            background: linear-gradient(135deg, #fff7e6 0%, #ffe6f0 100%);

            border-radius: 15px;            left: 0;        }

            padding: 20px;

            margin-top: 25px;            right: 0;

        }

            z-index: 99;            align-items: center;        

        .next-unlocks h3 { margin: 0 0 15px 0; color: #333; }

            background: rgba(255, 255, 255, 0.98);

        .unlock-item {

            background: white;            backdrop-filter: blur(10px);        .avatar-header-content {

            padding: 12px;

            border-radius: 10px;            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);

            margin-bottom: 10px;

            display: flex;            padding: 15px 20px;            display: flex;            gap: 10px;        .render-mode-toggle:hover {

            align-items: center;

            justify-content: space-between;            display: flex;

        }

            gap: 15px;            align-items: center;

        .unlock-item:last-child { margin-bottom: 0; }

        .unlock-item-name { font-weight: bold; color: #667eea; }            justify-content: center;

        .unlock-item-points { color: #ff6b6b; font-weight: bold; }

        .loading { display: flex; align-items: center; justify-content: center; padding: 40px; color: #667eea; font-size: 1.2rem; }            align-items: center;            gap: 20px;            padding: 10px 20px;            background: rgba(255, 255, 255, 0.2);



        @media (max-width: 768px) {        }

            .avatar-header-content { gap: 15px; }

            .avatar-preview { width: 70px; height: 70px; }            max-width: 1200px;

            .avatar-header.scrolled .avatar-preview { width: 50px; height: 50px; }

            .style-grid { grid-template-columns: 1fr; }        .btn {

            .options-grid { grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); }

            .action-buttons { flex-direction: column; gap: 10px; }            padding: 12px 30px;            margin: 0 auto;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            transform: scale(1.05);

            .btn { width: 100%; justify-content: center; }

        }            border: none;

    </style>

</head>            border-radius: 12px;        }

<body>

    <div class="avatar-header" id="avatarHeader">            cursor: pointer;

        <div class="avatar-header-content">

            <div class="avatar-preview">            font-size: 1rem;            border-radius: 25px;        }

                <img id="avatarPreviewImage" src="/api/avatar-custom/adventurer?seed=default" alt="Avatar">

            </div>            font-weight: bold;

            <div class="avatar-info">

                <h1>‚ú® Erstelle deinen Avatar</h1>            transition: all 0.3s;        .avatar-info {

                <div class="score-display">‚≠ê <span id="userScore">0</span> Punkte</div>

            </div>            display: flex;

        </div>

    </div>            align-items: center;            flex: 1;            color: white;    </style>



    <div class="editor-container">            gap: 8px;

        <div class="style-selector">

            <h2>üé® W√§hle deinen Avatar-Stil</h2>        }        }

            <div class="style-grid" id="styleGrid"></div>

        </div>



        <div class="customization-panel">        .btn-primary {            font-weight: bold;</head>

            <h2>‚öôÔ∏è Anpassungen</h2>

            <div id="customizationOptions"><div class="loading">Lade Optionen...</div></div>            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            <div class="next-unlocks" id="nextUnlocks" style="display: none;">

                <h3>üéÅ N√§chste Freischaltungen</h3>            color: white;        .avatar-header h1 {

                <div id="nextUnlocksList"></div>

            </div>        }

        </div>

    </div>            font-size: 1.8rem;            font-size: 1.2rem;<body>



    <div class="action-buttons">        .btn-secondary {

        <button class="btn btn-secondary" id="randomBtn">üé≤ Zuf√§llig</button>

        <button class="btn btn-primary" id="saveBtn">üíæ Speichern</button>            background: white;            margin: 0 0 5px 0;

    </div>

            color: #667eea;

    <script type="module">

        let styleSchemas = {}, currentStyle = 'adventurer', currentOptions = {}, userScore = 150;            border: 2px solid #667eea;            color: #333;        }    <div class="editor-container">



        async function init() {        }

            window.addEventListener('scroll', () => {

                const header = document.getElementById('avatarHeader');            transition: all 0.3s ease;

                header.classList.toggle('scrolled', window.scrollY > 50);

            });        .btn:hover {



            await loadStyleSchemas();            transform: translateY(-2px);        }        <div class="editor-header">

            document.getElementById('userScore').textContent = userScore;

            renderStyleSelector();            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);

            selectStyle('adventurer');

        }        }



        async function loadStyleSchemas() {

            try {

                const response = await fetch('avatarStyleSchemas.json');        .btn:active {        .score-display {        .editor-layout {            <h1>‚ú® Erstelle deinen Avatar</h1>

                styleSchemas = await response.json();

                console.log('Schemas geladen:', styleSchemas);            transform: translateY(0);

            } catch (error) {

                console.error('Fehler beim Laden:', error);        }            display: inline-flex;

                alert('Fehler beim Laden der Avatar-Konfiguration');

            }

        }

        /* Style Selector */            align-items: center;            display: grid;            <p class="editor-subtitle">Gestalte deine pers√∂nliche Weihnachtsfigur</p>

        function renderStyleSelector() {

            const grid = document.getElementById('styleGrid');        .style-selector {

            grid.innerHTML = '';

            background: white;            gap: 8px;

            Object.keys(styleSchemas).forEach(styleId => {

                const style = styleSchemas[styleId];            border-radius: 20px;

                const isLocked = userScore < style.unlockScore;

                const card = document.createElement('div');            padding: 25px;            padding: 6px 14px;            grid-template-columns: 1fr 400px;        </div>

                card.className = `style-card ${styleId === currentStyle ? 'active' : ''} ${isLocked ? 'locked' : ''}`;

                            margin-bottom: 25px;

                if (isLocked) {

                    card.innerHTML = `<div class="lock-badge">üîí ${style.unlockScore}‚òÖ</div><h3>${style.displayName}</h3><p>Ben√∂tigt ${style.unlockScore} Punkte</p>`;            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

                } else {

                    card.innerHTML = `<h3>${style.displayName}</h3><p>Verf√ºgbar ‚úì</p>`;        }

                    card.onclick = () => selectStyle(styleId);

                }            border-radius: 20px;            gap: 30px;

                grid.appendChild(card);

            });        .style-selector h2 {

        }

            margin: 0 0 20px 0;            color: white;

        function selectStyle(styleId) {

            const style = styleSchemas[styleId];            color: #333;

            if (!style || userScore < style.unlockScore) return;

        }            font-weight: bold;            margin-top: 30px;        <div class="editor-content">

            currentStyle = styleId;

            currentOptions = { seed: `User-${Date.now()}` };



            Object.keys(style.options).forEach(optionKey => {        .style-grid {            font-size: 1rem;

                const option = style.options[optionKey];

                if (userScore >= option.unlockScore && option.values.length > 0) {            display: grid;

                    currentOptions[optionKey] = option.values[0];

                }            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));        }        }            <!-- Avatar Vorschau -->

            });

            gap: 15px;

            renderStyleSelector();

            renderCustomizationOptions();        }

            updatePreview();

        }



        function renderCustomizationOptions() {        .style-card {        .avatar-preview {            <div class="avatar-preview-section" id="avatarPreviewSection">

            const container = document.getElementById('customizationOptions');

            const style = styleSchemas[currentStyle];            background: #f8f9fa;

            

            if (!style) {            border: 3px solid transparent;            width: 100px;

                container.innerHTML = '<p>Kein Style ausgew√§hlt</p>';

                return;            border-radius: 15px;

            }

            padding: 20px;            height: 100px;        @media (max-width: 768px) {                <div class="avatar-preview-card">

            container.innerHTML = '';

            const sortedOptions = Object.entries(style.options).sort((a, b) => a[1].unlockScore - b[1].unlockScore);            text-align: center;

            sortedOptions.forEach(([key, option]) => renderOptionGroup(key, option, container));

            updateNextUnlocks();            cursor: pointer;            border-radius: 50%;

        }

            transition: all 0.3s;

        function renderOptionGroup(key, option, container) {

            const isLocked = userScore < option.unlockScore;            position: relative;            overflow: hidden;            .editor-layout {                    <h2>Dein Avatar</h2>

            const group = document.createElement('div');

            group.className = 'option-group';        }

            

            const header = document.createElement('div');            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);

            header.className = 'option-header';

            header.innerHTML = `<h3>${option.displayName}</h3>${isLocked ? `<span class="unlock-badge">üîí ${option.unlockScore}‚òÖ</span>` : ''}`;        .style-card:hover:not(.locked) {

            group.appendChild(header);

            transform: translateY(-5px);            transition: all 0.3s ease;                grid-template-columns: 1fr;                    <div id="avatarPreview" class="avatar-preview"></div>

            const grid = document.createElement('div');

            grid.className = 'options-grid';            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);



            option.values.forEach(value => {        }            background: white;

                const item = document.createElement('div');

                item.className = `option-item ${option.type === 'color' ? 'color-option' : ''} ${currentOptions[key] === value ? 'active' : ''} ${isLocked ? 'locked' : ''}`;

                

                if (option.type === 'color') {        .style-card.active {            flex-shrink: 0;            }                </div>

                    item.style.background = `#${value}`;

                    item.title = `#${value}`;            border-color: #667eea;

                } else {

                    let displayText = value;            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);        }

                    if (value.startsWith('variant')) {

                        displayText = value.replace('variant', '').replace(/^0+/, '');        }

                    } else if (value.length > 12) {

                        displayText = value.substring(0, 10) + '...';        }            </div>

                    }

                    item.textContent = displayText;        .style-card.locked {

                    item.title = value;

                }            opacity: 0.5;        .avatar-preview img {



                if (!isLocked) item.onclick = () => selectOption(key, value);            cursor: not-allowed;

                grid.appendChild(item);

            });        }            width: 100%;



            group.appendChild(grid);

            container.appendChild(group);

        }        .lock-badge {            height: 100%;



        function selectOption(key, value) {            position: absolute;

            console.log(`Option: ${key} = ${value}`);

            currentOptions[key] = value;            top: 10px;            object-fit: cover;        .preview-panel {            <!-- Customization Options -->

            renderCustomizationOptions();

            updatePreview();            right: 10px;

        }

            background: #ff6b6b;        }

        function updatePreview() {

            const params = new URLSearchParams();            color: white;

            Object.keys(currentOptions).forEach(key => {

                if (currentOptions[key]) params.append(key, currentOptions[key]);            padding: 5px 10px;            background: white;            <div class="customization-section">

            });

                        border-radius: 10px;

            const url = `/api/avatar-custom/${currentStyle}?${params.toString()}`;

            console.log('Preview:', url);            font-size: 0.8rem;        /* Sticky Action Buttons am unteren Rand */

            document.getElementById('avatarPreviewImage').src = url;

        }        }



        function randomizeAvatar() {        .action-buttons {            border-radius: 20px;                <!-- Gender Selection -->

            const style = styleSchemas[currentStyle];

            if (!style) return;        /* Customization Options */



            console.log('Randomizing...');        .customization-panel {            position: fixed;

            currentOptions.seed = `User-${Date.now()}`;

            background: white;

            Object.keys(style.options).forEach(optionKey => {

                const option = style.options[optionKey];            border-radius: 20px;            bottom: 0;            padding: 30px;                <div class="gender-selection">

                if (userScore >= option.unlockScore && option.values.length > 0) {

                    currentOptions[optionKey] = option.values[Math.floor(Math.random() * option.values.length)];            padding: 25px;

                }

            });            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);            left: 0;



            renderCustomizationOptions();        }

            updatePreview();

        }            right: 0;            box-shadow: 0 10px 30px rgba(0,0,0,0.1);                    <h3>



        function saveAvatar() {        .option-group {

            const avatarData = { style: currentStyle, options: currentOptions, createdAt: new Date().toISOString() };

            localStorage.setItem('customAvatar', JSON.stringify(avatarData));            margin-bottom: 25px;            z-index: 99;

            console.log('Gespeichert:', avatarData);

            alert('‚úÖ Avatar erfolgreich gespeichert!');            padding-bottom: 25px;

        }

            border-bottom: 1px solid #e0e0e0;            background: rgba(255, 255, 255, 0.98);            position: sticky;                        <span class="category-icon">üé≠</span>

        function updateNextUnlocks() {

            const style = styleSchemas[currentStyle];        }

            const nextUnlocksDiv = document.getElementById('nextUnlocks');

            const listDiv = document.getElementById('nextUnlocksList');            backdrop-filter: blur(10px);

            

            const lockedOptions = [];        .option-group:last-child {

            Object.keys(style.options).forEach(optionKey => {

                const option = style.options[optionKey];            border-bottom: none;            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);            top: 20px;                        W√§hle deinen Style

                if (userScore < option.unlockScore) {

                    lockedOptions.push({ name: option.displayName, unlockScore: option.unlockScore });            margin-bottom: 0;

                }

            });            padding-bottom: 0;            padding: 15px 20px;



            lockedOptions.sort((a, b) => a.unlockScore - b.unlockScore);        }



            if (lockedOptions.length > 0) {            display: flex;            height: fit-content;                    </h3>

                nextUnlocksDiv.style.display = 'block';

                listDiv.innerHTML = '';        .option-header {

                lockedOptions.slice(0, 3).forEach(unlock => {

                    const item = document.createElement('div');            display: flex;            gap: 15px;

                    item.className = 'unlock-item';

                    item.innerHTML = `<span class="unlock-item-name">${unlock.name}</span><span class="unlock-item-points">${unlock.unlockScore}‚òÖ (noch ${unlock.unlockScore - userScore})</span>`;            align-items: center;

                    listDiv.appendChild(item);

                });            justify-content: space-between;            justify-content: center;        }                    <div class="gender-buttons">

            } else {

                nextUnlocksDiv.style.display = 'none';            margin-bottom: 15px;

            }

        }        }            align-items: center;



        document.getElementById('randomBtn').addEventListener('click', randomizeAvatar);

        document.getElementById('saveBtn').addEventListener('click', saveAvatar);

        init();        .option-header h3 {        }                        <button class="gender-button active" data-gender="babo">

    </script>

</body>            margin: 0;

</html>

            color: #333;

            font-size: 1.2rem;

        }        .btn {        .preview-avatar {                            <span class="gender-icon">üí™</span>



        .unlock-badge {            padding: 12px 30px;

            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);

            color: #333;            border: none;            width: 100%;                            <span class="gender-label">Babo</span>

            padding: 5px 12px;

            border-radius: 15px;            border-radius: 12px;

            font-size: 0.85rem;

            font-weight: bold;            cursor: pointer;            aspect-ratio: 1;                            <span class="gender-desc">Cool & Fresh</span>

        }

            font-size: 1rem;

        .options-grid {

            display: grid;            font-weight: bold;            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);                        </button>

            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));

            gap: 10px;            transition: all 0.3s;

        }

            display: flex;            border-radius: 20px;                        <button class="gender-button" data-gender="cutie">

        .option-item {

            aspect-ratio: 1;            align-items: center;

            border: 3px solid #e0e0e0;

            border-radius: 12px;            gap: 8px;            display: flex;                            <span class="gender-icon">‚ú®</span>

            cursor: pointer;

            transition: all 0.3s;        }

            display: flex;

            align-items: center;            align-items: center;                            <span class="gender-label">Cutie</span>

            justify-content: center;

            font-size: 0.8rem;        .btn-primary {

            font-weight: bold;

            color: #666;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            justify-content: center;                            <span class="gender-desc">Cute & Sweet</span>

            background: #f8f9fa;

            position: relative;            color: white;

            overflow: hidden;

        }        }            margin-bottom: 20px;                        </button>



        .option-item:hover:not(.locked) {

            border-color: #667eea;

            transform: scale(1.05);        .btn-secondary {            overflow: hidden;                    </div>

        }

            background: white;

        .option-item.active {

            border-color: #667eea;            color: #667eea;        }                </div>

            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);

            color: #667eea;            border: 2px solid #667eea;

        }

        }                

        .option-item.locked {

            opacity: 0.4;

            cursor: not-allowed;

        }        .btn:hover {        .preview-avatar img {                <!-- Username Input -->



        .option-item.locked::after {            transform: translateY(-2px);

            content: 'üîí';

            position: absolute;            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);            width: 90%;                <div class="input-section">

            font-size: 1.5rem;

        }        }



        .option-item.color-option {            height: 90%;                    <label for="usernameInput">

            border-radius: 50%;

        }        .btn:active {



        /* Next Unlocks */            transform: translateY(0);            object-fit: contain;                        <span class="label-icon">üë§</span>

        .next-unlocks {

            background: linear-gradient(135deg, #fff7e6 0%, #ffe6f0 100%);        }

            border-radius: 15px;

            padding: 20px;        }                        <span class="label-text">Dein Name</span>

            margin-top: 25px;

        }        /* Style Selector */



        .next-unlocks h3 {        .style-selector {                    </label>

            margin: 0 0 15px 0;

            color: #333;            background: white;

        }

            border-radius: 20px;        .save-button {                    <input 

        .unlock-item {

            background: white;            padding: 25px;

            padding: 12px;

            border-radius: 10px;            margin-bottom: 25px;            width: 100%;                        type="text" 

            margin-bottom: 10px;

            display: flex;            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);

            align-items: center;

            justify-content: space-between;        }            padding: 15px;                        id="usernameInput" 

        }



        .unlock-item:last-child {

            margin-bottom: 0;        .style-selector h2 {            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);                        placeholder="Gib deinen Namen ein..." 

        }

            margin: 0 0 20px 0;

        .unlock-item-name {

            font-weight: bold;            color: #333;            color: white;                        maxlength="20"

            color: #667eea;

        }        }



        .unlock-item-points {            border: none;                        autocomplete="off"

            color: #ff6b6b;

            font-weight: bold;        .style-grid {

        }

            display: grid;            border-radius: 10px;                    >

        .loading {

            display: flex;            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));

            align-items: center;

            justify-content: center;            gap: 15px;            font-size: 1.1rem;                    <span class="char-counter">0/20</span>

            padding: 40px;

            color: #667eea;        }

            font-size: 1.2rem;

        }            font-weight: bold;                </div>



        @media (max-width: 768px) {        .style-card {

            .avatar-header-content {

                gap: 15px;            background: #f8f9fa;            cursor: pointer;

            }

            border: 3px solid transparent;

            .avatar-preview {

                width: 70px;            border-radius: 15px;            transition: transform 0.2s;                <!-- Kopfbedeckung -->

                height: 70px;

            }            padding: 20px;



            .avatar-header.scrolled .avatar-preview {            text-align: center;        }                <div class="customization-category">

                width: 50px;

                height: 50px;            cursor: pointer;

            }

            transition: all 0.3s;                    <h3>

            .style-grid {

                grid-template-columns: 1fr;            position: relative;

            }

        }        .save-button:hover {                        <span class="category-icon">üé©</span>

            .options-grid {

                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));

            }

        .style-card:hover:not(.locked) {            transform: scale(1.05);                        Kopfbedeckung

            .action-buttons {

                flex-direction: column;            transform: translateY(-5px);

                gap: 10px;

            }            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);        }                    </h3>



            .btn {        }

                width: 100%;

                justify-content: center;                    <div id="headOptions" class="option-grid"></div>

            }

        }        .style-card.active {

    </style>

</head>            border-color: #667eea;        .options-panel {                </div>

<body>

    <div class="avatar-header" id="avatarHeader">            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);

        <div class="avatar-header-content">

            <div class="avatar-preview" id="avatarPreviewHeader">        }            background: white;

                <img id="avatarPreviewImage" src="/api/avatar-custom/adventurer?seed=default" alt="Avatar Preview">

            </div>

            <div class="avatar-info">

                <h1>‚ú® Erstelle deinen Avatar</h1>        .style-card.locked {            border-radius: 20px;                <!-- Gesicht -->

                <div class="score-display">

                    ‚≠ê <span id="userScore">0</span> Punkte            opacity: 0.5;

                </div>

            </div>            cursor: not-allowed;            padding: 30px;                <div class="customization-category">

        </div>

    </div>        }



    <div class="editor-container">            box-shadow: 0 10px 30px rgba(0,0,0,0.1);                    <h3>

        <div class="style-selector">

            <h2>üé® W√§hle deinen Avatar-Stil</h2>        .lock-badge {

            <div class="style-grid" id="styleGrid"></div>

        </div>            position: absolute;        }                        <span class="category-icon">üòä</span>



        <div class="customization-panel">            top: 10px;

            <h2>‚öôÔ∏è Anpassungen</h2>

            <div id="customizationOptions">            right: 10px;                        Gesicht

                <div class="loading">Lade Optionen...</div>

            </div>            background: #ff6b6b;



            <div class="next-unlocks" id="nextUnlocks" style="display: none;">            color: white;        .style-grid {                    </h3>

                <h3>üéÅ N√§chste Freischaltungen</h3>

                <div id="nextUnlocksList"></div>            padding: 5px 10px;

            </div>

        </div>            border-radius: 10px;            display: grid;                    <div id="faceOptions" class="option-grid"></div>

    </div>

            font-size: 0.8rem;

    <div class="action-buttons">

        <button class="btn btn-secondary" id="randomBtn">üé≤ Zuf√§llig</button>        }            grid-template-columns: repeat(2, 1fr);                </div>

        <button class="btn btn-primary" id="saveBtn">üíæ Speichern</button>

    </div>



    <script type="module">        /* Customization Options */            gap: 15px;

        let styleSchemas = {};

        let currentStyle = 'adventurer';        .customization-panel {

        let currentOptions = {};

        let userScore = 150;            background: white;            margin-top: 15px;                <!-- K√∂rper -->



        async function init() {            border-radius: 20px;

            window.addEventListener('scroll', () => {

                const header = document.getElementById('avatarHeader');            padding: 25px;        }                <div class="customization-category">

                if (window.scrollY > 50) {

                    header.classList.add('scrolled');            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);

                } else {

                    header.classList.remove('scrolled');        }                    <h3>

                }

            });



            await loadStyleSchemas();        .option-group {        .style-card {                        <span class="category-icon">üëï</span>

            document.getElementById('userScore').textContent = userScore;

            renderStyleSelector();            margin-bottom: 25px;

            selectStyle('adventurer');

        }            padding-bottom: 25px;            padding: 20px;                        Kleidung



        async function loadStyleSchemas() {            border-bottom: 1px solid #e0e0e0;

            try {

                const response = await fetch('avatarStyleSchemas.json');        }            border: 3px solid #e0e0e0;                    </h3>

                styleSchemas = await response.json();

                console.log('Style-Schemas geladen:', styleSchemas);

            } catch (error) {

                console.error('Fehler beim Laden der Style-Schemas:', error);        .option-group:last-child {            border-radius: 15px;                    <div id="bodyOptions" class="option-grid"></div>

                alert('Fehler beim Laden der Avatar-Konfiguration');

            }            border-bottom: none;

        }

            margin-bottom: 0;            cursor: pointer;                </div>

        function renderStyleSelector() {

            const grid = document.getElementById('styleGrid');            padding-bottom: 0;

            grid.innerHTML = '';

        }            transition: all 0.3s;

            Object.keys(styleSchemas).forEach(styleId => {

                const style = styleSchemas[styleId];

                const isLocked = userScore < style.unlockScore;

        .option-header {            text-align: center;                <!-- F√º√üe -->

                const card = document.createElement('div');

                card.className = `style-card ${styleId === currentStyle ? 'active' : ''} ${isLocked ? 'locked' : ''}`;            display: flex;

                

                if (isLocked) {            align-items: center;            position: relative;                <div class="customization-category">

                    card.innerHTML = `

                        <div class="lock-badge">üîí ${style.unlockScore}‚òÖ</div>            justify-content: space-between;

                        <h3>${style.displayName}</h3>

                        <p>Ben√∂tigt ${style.unlockScore} Punkte</p>            margin-bottom: 15px;        }                    <h3>

                    `;

                } else {        }

                    card.innerHTML = `

                        <h3>${style.displayName}</h3>                        <span class="category-icon">üë¢</span>

                        <p>Verf√ºgbar ‚úì</p>

                    `;        .option-header h3 {

                    card.onclick = () => selectStyle(styleId);

                }            margin: 0;        .style-card:hover {                        Schuhe



                grid.appendChild(card);            color: #333;

            });

        }            font-size: 1.2rem;            border-color: #667eea;                    </h3>



        function selectStyle(styleId) {        }

            const style = styleSchemas[styleId];

            if (!style || userScore < style.unlockScore) return;            transform: translateY(-5px);                    <div id="feetOptions" class="option-grid"></div>



            currentStyle = styleId;        .unlock-badge {

            currentOptions = { seed: `User-${Date.now()}` };

            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);        }                </div>

            Object.keys(style.options).forEach(optionKey => {

                const option = style.options[optionKey];            color: #333;

                if (userScore >= option.unlockScore && option.values.length > 0) {

                    currentOptions[optionKey] = option.values[0];            padding: 5px 12px;            </div>

                }

            });            border-radius: 15px;



            renderStyleSelector();            font-size: 0.85rem;        .style-card.active {        </div>

            renderCustomizationOptions();

            updatePreview();            font-weight: bold;

        }

        }            border-color: #667eea;

        function renderCustomizationOptions() {

            const container = document.getElementById('customizationOptions');

            const style = styleSchemas[currentStyle];

                    .options-grid {            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);        <!-- Action Buttons -->

            if (!style) {

                container.innerHTML = '<p>Kein Style ausgew√§hlt</p>';            display: grid;

                return;

            }            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));        }        <div class="editor-actions">



            container.innerHTML = '';            gap: 10px;



            const sortedOptions = Object.entries(style.options).sort((a, b) =>         }            <button id="randomizeButton" class="btn-secondary">

                a[1].unlockScore - b[1].unlockScore

            );



            sortedOptions.forEach(([key, option]) => {        .option-item {        .style-card.locked {                üé≤ Zuf√§llig generieren

                renderOptionGroup(key, option, container);

            });            aspect-ratio: 1;



            updateNextUnlocks();            border: 3px solid #e0e0e0;            opacity: 0.5;            </button>

        }

            border-radius: 12px;

        function renderOptionGroup(key, option, container) {

            const isLocked = userScore < option.unlockScore;            cursor: pointer;            cursor: not-allowed;            <button id="saveButton" class="btn-primary">

            

            const group = document.createElement('div');            transition: all 0.3s;

            group.className = 'option-group';

                        display: flex;        }                ‚úÖ Speichern & Loslegen!

            const header = document.createElement('div');

            header.className = 'option-header';            align-items: center;

            header.innerHTML = `

                <h3>${option.displayName}</h3>            justify-content: center;            </button>

                ${isLocked ? `<span class="unlock-badge">üîí ${option.unlockScore}‚òÖ</span>` : ''}

            `;            font-size: 0.8rem;

            group.appendChild(header);

            font-weight: bold;        .unlock-badge {        </div>

            const grid = document.createElement('div');

            grid.className = 'options-grid';            color: #666;



            option.values.forEach(value => {            background: #f8f9fa;            position: absolute;    </div>

                const item = document.createElement('div');

                item.className = `option-item ${option.type === 'color' ? 'color-option' : ''} ${currentOptions[key] === value ? 'active' : ''} ${isLocked ? 'locked' : ''}`;            position: relative;

                

                if (option.type === 'color') {            overflow: hidden;            top: 10px;

                    item.style.background = `#${value}`;

                    item.title = `#${value}`;        }

                } else {

                    let displayText = value;            right: 10px;    <!-- Success Modal -->

                    if (value.startsWith('variant')) {

                        displayText = value.replace('variant', '').replace(/^0+/, '');        .option-item:hover:not(.locked) {

                    } else if (value.length > 12) {

                        displayText = value.substring(0, 10) + '...';            border-color: #667eea;            background: #ff9800;    <div id="successModal" class="modal">

                    }

                    item.textContent = displayText;            transform: scale(1.05);

                    item.title = value;

                }        }            color: white;        <div class="modal-content">



                if (!isLocked) {

                    item.onclick = () => selectOption(key, value);

                }        .option-item.active {            padding: 4px 8px;            <div class="success-icon">üéâ</div>



                grid.appendChild(item);            border-color: #667eea;

            });

            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);            border-radius: 10px;            <h2>Avatar erstellt!</h2>

            group.appendChild(grid);

            container.appendChild(group);            color: #667eea;

        }

        }            font-size: 0.8rem;            <p>Dein Avatar wurde erfolgreich gespeichert.</p>

        function selectOption(key, value) {

            console.log(`Option gew√§hlt: ${key} = ${value}`);

            currentOptions[key] = value;

            renderCustomizationOptions();        .option-item.locked {            font-weight: bold;            <div id="finalAvatarPreview" class="final-avatar-preview"></div>

            updatePreview();

        }            opacity: 0.4;



        function updatePreview() {            cursor: not-allowed;        }            <button id="continueButton" class="btn-primary">

            const params = new URLSearchParams();

                    }

            Object.keys(currentOptions).forEach(key => {

                if (currentOptions[key]) {                Zum Adventskalender

                    params.append(key, currentOptions[key]);

                }        .option-item.locked::after {

            });

                        content: 'üîí';        .option-group {            </button>

            const url = `/api/avatar-custom/${currentStyle}?${params.toString()}`;

            console.log('Preview URL:', url);            position: absolute;

            

            const img = document.getElementById('avatarPreviewImage');            font-size: 1.5rem;            margin-bottom: 30px;        </div>

            img.src = url;

            img.alt = `${currentStyle} Avatar`;        }

        }

        }    </div>

        function randomizeAvatar() {

            const style = styleSchemas[currentStyle];        /* Color Options */

            if (!style) return;

        .option-item.color-option {

            console.log('Randomizing avatar...');

            currentOptions.seed = `User-${Date.now()}`;            border-radius: 50%;



            Object.keys(style.options).forEach(optionKey => {        }        .option-group h3 {    <script src="avatarManager.js"></script>

                const option = style.options[optionKey];

                if (userScore >= option.unlockScore && option.values.length > 0) {

                    const randomIndex = Math.floor(Math.random() * option.values.length);

                    currentOptions[optionKey] = option.values[randomIndex];        /* Next Unlocks */            color: #333;    <script src="avatar3DRenderer.js"></script>

                }

            });        .next-unlocks {



            renderCustomizationOptions();            background: linear-gradient(135deg, #fff7e6 0%, #ffe6f0 100%);            margin-bottom: 15px;    <script src="avatar-editor.js"></script>

            updatePreview();

        }            border-radius: 15px;



        function saveAvatar() {            padding: 20px;            display: flex;    

            const avatarData = {

                style: currentStyle,            margin-top: 25px;

                options: currentOptions,

                createdAt: new Date().toISOString()        }            align-items: center;    <script>

            };



            localStorage.setItem('customAvatar', JSON.stringify(avatarData));

            console.log('Avatar gespeichert:', avatarData);        .next-unlocks h3 {            gap: 10px;        // Toggle zwischen 2D und 3D Rendering

            alert('‚úÖ Avatar erfolgreich gespeichert!');

        }            margin: 0 0 15px 0;



        function updateNextUnlocks() {            color: #333;        }        const previewCard = document.querySelector('.avatar-preview-card');

            const style = styleSchemas[currentStyle];

            const nextUnlocksDiv = document.getElementById('nextUnlocks');        }

            const listDiv = document.getElementById('nextUnlocksList');

                    if (previewCard) {

            const lockedOptions = [];

            Object.keys(style.options).forEach(optionKey => {        .unlock-item {

                const option = style.options[optionKey];

                if (userScore < option.unlockScore) {            background: white;        .locked-badge {            const toggleButton = document.createElement('button');

                    lockedOptions.push({

                        name: option.displayName,            padding: 12px;

                        unlockScore: option.unlockScore

                    });            border-radius: 10px;            background: #ff9800;            toggleButton.className = 'render-mode-toggle';

                }

            });            margin-bottom: 10px;



            lockedOptions.sort((a, b) => a.unlockScore - b.unlockScore);            display: flex;            color: white;            toggleButton.innerHTML = 'üé® 3D-Modus';



            if (lockedOptions.length > 0) {            align-items: center;

                nextUnlocksDiv.style.display = 'block';

                listDiv.innerHTML = '';            justify-content: space-between;            padding: 4px 12px;            previewCard.style.position = 'relative';



                lockedOptions.slice(0, 3).forEach(unlock => {        }

                    const item = document.createElement('div');

                    item.className = 'unlock-item';            border-radius: 15px;            previewCard.appendChild(toggleButton);

                    item.innerHTML = `

                        <span class="unlock-item-name">${unlock.name}</span>        .unlock-item:last-child {

                        <span class="unlock-item-points">${unlock.unlockScore}‚òÖ (noch ${unlock.unlockScore - userScore})</span>

                    `;            margin-bottom: 0;            font-size: 0.8rem;            

                    listDiv.appendChild(item);

                });        }

            } else {

                nextUnlocksDiv.style.display = 'none';            font-weight: bold;            toggleButton.addEventListener('click', () => {

            }

        }        .unlock-item-name {



        document.getElementById('randomBtn').addEventListener('click', randomizeAvatar);            font-weight: bold;        }                const editor = window.avatarEditor;

        document.getElementById('saveBtn').addEventListener('click', saveAvatar);

            color: #667eea;

        init();

    </script>        }                if (editor) {

</body>

</html>


        .unlock-item-points {        .option-grid {                    editor.use3DRenderer = !editor.use3DRenderer;

            color: #ff6b6b;

            font-weight: bold;            display: grid;                    toggleButton.innerHTML = editor.use3DRenderer ? 'üé® 3D-Modus' : 'üìê 2D-Modus';

        }

            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));                    editor.updatePreview();

        /* Loading State */

        .loading {            gap: 10px;                }

            display: flex;

            align-items: center;        }            });

            justify-content: center;

            padding: 40px;        }

            color: #667eea;

            font-size: 1.2rem;        .option-button {    </script>

        }

            padding: 12px;</body>

        @media (max-width: 768px) {

            .avatar-header-content {            border: 2px solid #e0e0e0;</html>

                gap: 15px;

            }            border-radius: 10px;

            background: white;

            .avatar-preview {            cursor: pointer;

                width: 70px;            transition: all 0.2s;

                height: 70px;            text-align: center;

            }            font-size: 0.9rem;

        }

            .avatar-header.scrolled .avatar-preview {

                width: 50px;        .option-button:hover {

                height: 50px;            border-color: #667eea;

            }            transform: scale(1.05);

        }

            .style-grid {

                grid-template-columns: 1fr;        .option-button.active {

            }            border-color: #667eea;

            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);

            .options-grid {        }

                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));

            }        .option-button.disabled {

            opacity: 0.4;

            .action-buttons {            cursor: not-allowed;

                flex-direction: column;        }

                gap: 10px;

            }        .color-swatch {

            width: 40px;

            .btn {            height: 40px;

                width: 100%;            border-radius: 50%;

                justify-content: center;            margin: 5px auto;

            }            border: 3px solid white;

        }            box-shadow: 0 2px 8px rgba(0,0,0,0.2);

    </style>        }

</head>

<body>        .next-unlocks {

    <!-- Sticky Avatar Header -->            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);

    <div class="avatar-header" id="avatarHeader">            border-radius: 15px;

        <div class="avatar-header-content">            padding: 20px;

            <div class="avatar-preview" id="avatarPreviewHeader">            margin-top: 30px;

                <img id="avatarPreviewImage" src="/api/avatar-custom/adventurer?seed=default" alt="Avatar Preview">        }

            </div>

            <div class="avatar-info">        .unlock-item {

                <h1>‚ú® Erstelle deinen Avatar</h1>            background: white;

                <div class="score-display">            padding: 12px;

                    ‚≠ê <span id="userScore">0</span> Punkte            border-radius: 10px;

                </div>            margin-bottom: 10px;

            </div>            display: flex;

        </div>            justify-content: space-between;

    </div>            align-items: center;

        }

    <div class="editor-container">

        <!-- Style Selector -->        .points-needed {

        <div class="style-selector">            background: #ff9800;

            <h2>üé® W√§hle deinen Avatar-Stil</h2>            color: white;

            <div class="style-grid" id="styleGrid">            padding: 4px 12px;

                <!-- Wird dynamisch gef√ºllt -->            border-radius: 15px;

            </div>            font-weight: bold;

        </div>            font-size: 0.9rem;

        }

        <!-- Customization Panel -->    </style>

        <div class="customization-panel"></head>

            <h2>‚öôÔ∏è Anpassungen</h2><body>

            <div id="customizationOptions">    <div class="editor-container">

                <div class="loading">Lade Optionen...</div>        <div class="editor-header">

            </div>            <h1>üé® Avatar Editor</h1>

            <div class="score-display">

            <!-- Next Unlocks -->                <span>‚≠ê</span>

            <div class="next-unlocks" id="nextUnlocks" style="display: none;">                <span id="userScore">0</span>

                <h3>üéÅ N√§chste Freischaltungen</h3>                <span>Punkte</span>

                <div id="nextUnlocksList"></div>            </div>

            </div>        </div>

        </div>

    </div>        <div class="editor-layout">

            <div class="options-panel">

    <!-- Sticky Action Buttons -->                <div class="style-selector">

    <div class="action-buttons">                    <h2>W√§hle deinen Style</h2>

        <button class="btn btn-secondary" onclick="randomizeAvatar()">                    <div class="style-grid" id="styleGrid"></div>

            üé≤ Zuf√§llig                </div>

        </button>

        <button class="btn btn-primary" onclick="saveAvatar()">                <div id="customizationOptions"></div>

            üíæ Speichern

        </button>                <div class="next-unlocks" id="nextUnlocks" style="display: none;">

    </div>                    <h3>üîì N√§chste Freischaltungen</h3>

                    <div id="unlocksList"></div>

    <script>                </div>

        // Globale Variablen            </div>

        let styleSchemas = {};

        let currentStyle = 'adventurer';            <div class="preview-panel">

        let currentOptions = {};                <div class="preview-avatar">

        let userScore = 150; // Demo-Wert, sp√§ter aus Stats laden                    <img src="" alt="Avatar Preview" id="avatarImage">

                </div>

        // Initialisierung                <div class="preview-info">

        async function init() {                    <h3 id="previewTitle">Dein Avatar</h3>

            // Scroll-Handler f√ºr Sticky Header                    <p id="previewStyle">Adventurer Style</p>

            window.addEventListener('scroll', () => {                </div>

                const header = document.getElementById('avatarHeader');                <button class="save-button" onclick="saveAvatar()">üíæ Avatar Speichern</button>

                if (window.scrollY > 50) {                <button class="save-button" onclick="randomize()" style="margin-top: 10px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">üé≤ Zuf√§llig</button>

                    header.classList.add('scrolled');            </div>

                } else {        </div>

                    header.classList.remove('scrolled');    </div>

                }

            });    <script src="avatarEditorConfig.js"></script>

    <script>

            // Lade Style-Schemas        let currentStyle = 'adventurer';

            await loadStyleSchemas();        let currentOptions = {

                        seed: 'User-' + Date.now(),

            // Setze initialen Score            eyes: 'variant01',

            document.getElementById('userScore').textContent = userScore;            mouth: 'variant01',

                        hair: 'short01',

            // Rendere Style-Auswahl            hairColor: '6a4e35',

            renderStyleSelector();            skinColor: 'f2d3b1',

                        eyebrows: 'variant01'

            // Lade ersten Style        };

            selectStyle('adventurer');        let userScore = 0;

        }

        function loadUserScore() {

        // Lade Style-Schemas aus JSON            // TODO: Integration mit Stats-System - F√ºr Demo: 150 Punkte

        async function loadStyleSchemas() {            userScore = 150;

            try {            document.getElementById('userScore').textContent = userScore;

                const response = await fetch('avatarStyleSchemas.json');        }

                styleSchemas = await response.json();

                console.log('Style-Schemas geladen:', styleSchemas);        function init() {

            } catch (error) {            loadUserScore();

                console.error('Fehler beim Laden der Style-Schemas:', error);            renderStyleSelector();

                alert('Fehler beim Laden der Avatar-Konfiguration');            renderCustomizationOptions();

            }            updatePreview();

        }            updateNextUnlocks();

        }

        // Rendere Style-Auswahl

        function renderStyleSelector() {        function renderStyleSelector() {

            const grid = document.getElementById('styleGrid');            const grid = document.getElementById('styleGrid');

            grid.innerHTML = '';            const availableStyles = AvatarEditorConfig.getAvailableStyles(userScore);

            const allStyles = Object.values(AvatarEditorConfig.styles);

            Object.keys(styleSchemas).forEach(styleId => {

                const style = styleSchemas[styleId];            grid.innerHTML = allStyles.map(style => {

                const isLocked = userScore < style.unlockScore;                const isUnlocked = availableStyles.find(s => s.id === style.id);

                const isActive = style.id === currentStyle;

                const card = document.createElement('div');

                card.className = `style-card ${styleId === currentStyle ? 'active' : ''} ${isLocked ? 'locked' : ''}`;                return `

                                    <div class="style-card ${isActive ? 'active' : ''} ${!isUnlocked ? 'locked' : ''}" 

                if (isLocked) {                         onclick="${isUnlocked ? `selectStyle('${style.id}')` : ''}">

                    card.innerHTML = `                        ${!isUnlocked ? `<div class="unlock-badge">üîí ${style.unlockScore}‚òÖ</div>` : ''}

                        <div class="lock-badge">üîí ${style.unlockScore}‚òÖ</div>                        <h4>${style.name}</h4>

                        <h3>${style.displayName}</h3>                        <p style="font-size: 0.9rem; color: #666;">${style.description}</p>

                        <p>Ben√∂tigt ${style.unlockScore} Punkte</p>                    </div>

                    `;                `;

                } else {            }).join('');

                    card.innerHTML = `        }

                        <h3>${style.displayName}</h3>

                        <p>Verf√ºgbar ‚úì</p>        function selectStyle(styleId) {

                    `;            currentStyle = styleId;

                    card.onclick = () => selectStyle(styleId);            renderStyleSelector();

                }            renderCustomizationOptions();

            updatePreview();

                grid.appendChild(card);            updateNextUnlocks();

            });        }

        }

        function renderCustomizationOptions() {

        // W√§hle einen Style            const container = document.getElementById('customizationOptions');

        function selectStyle(styleId) {            const available = AvatarEditorConfig.getAvailableOptions(currentStyle, userScore);

            const style = styleSchemas[styleId];            

            if (!style || userScore < style.unlockScore) {            let html = '<h2>Anpassungen</h2>';

                return;

            }            for (const [key, option] of Object.entries(available.basic)) {

                html += renderOptionGroup(key, option, false);

            currentStyle = styleId;            }

            currentOptions = {

                seed: `User-${Date.now()}`            if (Object.keys(available.advanced).length > 0) {

            };                html += '<h2 style="margin-top: 30px;">üåü Fortgeschritten</h2>';

                for (const [key, option] of Object.entries(available.advanced)) {

            // Setze Default-Werte f√ºr alle verf√ºgbaren Optionen                    html += renderOptionGroup(key, option, false);

            Object.keys(style.options).forEach(optionKey => {                }

                const option = style.options[optionKey];            }

                if (userScore >= option.unlockScore && option.values.length > 0) {

                    currentOptions[optionKey] = option.values[0];            container.innerHTML = html;

                }        }

            });

        function renderOptionGroup(key, option, isLocked) {

            renderStyleSelector();            let html = `

            renderCustomizationOptions();                <div class="option-group">

            updatePreview();                    <h3>

        }                        ${option.label}

                        ${isLocked ? `<span class="locked-badge">üîí ${option.unlockScore}‚òÖ</span>` : ''}

        // Rendere Anpassungsoptionen                    </h3>

        function renderCustomizationOptions() {                    <div class="option-grid">

            const container = document.getElementById('customizationOptions');            `;

            const style = styleSchemas[currentStyle];

                        option.options.forEach(opt => {

            if (!style) {                const isActive = currentOptions[key] === opt.value;

                container.innerHTML = '<p>Kein Style ausgew√§hlt</p>';                const disabled = isLocked ? 'disabled' : '';

                return;

            }                if (opt.color) {

                    html += `

            container.innerHTML = '';                        <div class="option-button ${isActive ? 'active' : ''} ${disabled}" 

                             onclick="${!isLocked ? `selectOption('${key}', '${opt.value}')` : ''}">

            // Sortiere Optionen nach Unlock-Score                            <div class="color-swatch" style="background: ${opt.color};"></div>

            const sortedOptions = Object.entries(style.options).sort((a, b) =>                             <div style="font-size: 0.8rem; margin-top: 5px;">${opt.label}</div>

                a[1].unlockScore - b[1].unlockScore                        </div>

            );                    `;

                } else {

            // Rendere jede Option                    html += `

            sortedOptions.forEach(([key, option]) => {                        <div class="option-button ${isActive ? 'active' : ''} ${disabled}" 

                renderOptionGroup(key, option, container);                             onclick="${!isLocked ? `selectOption('${key}', '${opt.value}')` : ''}">

            });                            ${opt.preview || ''}

                            <div style="font-size: 0.8rem; margin-top: 5px;">${opt.label}</div>

            // Zeige Next Unlocks                        </div>

            updateNextUnlocks();                    `;

        }                }

            });

        // Rendere eine Option-Gruppe

        function renderOptionGroup(key, option, container) {            html += `</div></div>`;

            const isLocked = userScore < option.unlockScore;            return html;

                    }

            const group = document.createElement('div');

            group.className = 'option-group';        function selectOption(key, value) {

                        currentOptions[key] = value;

            const header = document.createElement('div');            renderCustomizationOptions();

            header.className = 'option-header';            updatePreview();

            header.innerHTML = `        }

                <h3>${option.displayName}</h3>

                ${isLocked ? `<span class="unlock-badge">üîí ${option.unlockScore}‚òÖ</span>` : ''}        function updatePreview() {

            `;            const params = new URLSearchParams();

            group.appendChild(header);            params.append('seed', currentOptions.seed);

            

            const grid = document.createElement('div');            for (const [key, value] of Object.entries(currentOptions)) {

            grid.className = 'options-grid';                if (key !== 'seed' && value) {

                    params.append(key, value);

            option.values.forEach(value => {                }

                const item = document.createElement('div');            }

                item.className = `option-item ${option.type === 'color' ? 'color-option' : ''} ${currentOptions[key] === value ? 'active' : ''} ${isLocked ? 'locked' : ''}`;

                            const avatarUrl = `/api/avatar-custom/${currentStyle}?${params.toString()}`;

                if (option.type === 'color') {            document.getElementById('avatarImage').src = avatarUrl;

                    item.style.background = `#${value}`;            document.getElementById('previewStyle').textContent = 

                    item.title = `#${value}`;                AvatarEditorConfig.styles[currentStyle].name;

                } else {        }

                    // Zeige die Varianten-Nummer oder den Namen

                    let displayText = value;        function updateNextUnlocks() {

                    if (value.startsWith('variant')) {            const nextUnlocks = AvatarEditorConfig.getNextUnlocks(currentStyle, userScore);

                        displayText = value.replace('variant', '').replace(/^0+/, '');            const container = document.getElementById('nextUnlocks');

                    } else if (value.length > 12) {            const list = document.getElementById('unlocksList');

                        displayText = value.substring(0, 10) + '...';

                    }            if (nextUnlocks.length === 0) {

                    item.textContent = displayText;                container.style.display = 'none';

                    item.title = value;                return;

                }            }



                if (!isLocked) {            container.style.display = 'block';

                    item.onclick = () => selectOption(key, value);            list.innerHTML = nextUnlocks.slice(0, 3).map(unlock => `

                }                <div class="unlock-item">

                    <span>${unlock.label}</span>

                grid.appendChild(item);                    <span class="points-needed">+${unlock.pointsNeeded}‚òÖ</span>

            });                </div>

            `).join('');

            group.appendChild(grid);        }

            container.appendChild(group);

        }        function randomize() {

            const available = AvatarEditorConfig.getAvailableOptions(currentStyle, userScore);

        // W√§hle eine Option            

        function selectOption(key, value) {            for (const [key, option] of Object.entries({...available.basic, ...available.advanced})) {

            console.log(`Option gew√§hlt: ${key} = ${value}`);                if (option.options.length > 0) {

            currentOptions[key] = value;                    const randomIndex = Math.floor(Math.random() * option.options.length);

            renderCustomizationOptions();                    currentOptions[key] = option.options[randomIndex].value;

            updatePreview();                }

        }            }



        // Update Avatar Preview            renderCustomizationOptions();

        function updatePreview() {            updatePreview();

            const params = new URLSearchParams();        }

            

            // F√ºge alle aktuellen Optionen hinzu        function saveAvatar() {

            Object.keys(currentOptions).forEach(key => {            alert('Avatar gespeichert!');

                if (currentOptions[key]) {        }

                    params.append(key, currentOptions[key]);

                }        init();

            });    </script>

            </body>

            const url = `/api/avatar-custom/${currentStyle}?${params.toString()}`;</html>

            console.log('Preview URL:', url);
            
            const img = document.getElementById('avatarPreviewImage');
            img.src = url;
            img.alt = `${currentStyle} Avatar`;
        }

        // Randomize Avatar
        function randomizeAvatar() {
            const style = styleSchemas[currentStyle];
            if (!style) return;

            console.log('Randomizing avatar...');

            // Generiere neue Seed
            currentOptions.seed = `User-${Date.now()}`;

            // Randomisiere alle freigeschalteten Optionen
            Object.keys(style.options).forEach(optionKey => {
                const option = style.options[optionKey];
                if (userScore >= option.unlockScore && option.values.length > 0) {
                    const randomIndex = Math.floor(Math.random() * option.values.length);
                    currentOptions[optionKey] = option.values[randomIndex];
                }
            });

            renderCustomizationOptions();
            updatePreview();
        }

        // Save Avatar
        function saveAvatar() {
            const avatarData = {
                style: currentStyle,
                options: currentOptions,
                createdAt: new Date().toISOString()
            };

            localStorage.setItem('customAvatar', JSON.stringify(avatarData));
            console.log('Avatar gespeichert:', avatarData);
            
            alert('‚úÖ Avatar erfolgreich gespeichert!');
            
            // Optional: Zur√ºck zur Hauptseite
            // window.location.href = 'index.html';
        }

        // Update Next Unlocks
        function updateNextUnlocks() {
            const style = styleSchemas[currentStyle];
            const nextUnlocksDiv = document.getElementById('nextUnlocks');
            const listDiv = document.getElementById('nextUnlocksList');
            
            const lockedOptions = [];
            Object.keys(style.options).forEach(optionKey => {
                const option = style.options[optionKey];
                if (userScore < option.unlockScore) {
                    lockedOptions.push({
                        name: option.displayName,
                        unlockScore: option.unlockScore
                    });
                }
            });

            // Sortiere nach Unlock-Score
            lockedOptions.sort((a, b) => a.unlockScore - b.unlockScore);

            if (lockedOptions.length > 0) {
                nextUnlocksDiv.style.display = 'block';
                listDiv.innerHTML = '';

                // Zeige die n√§chsten 3 Unlocks
                lockedOptions.slice(0, 3).forEach(unlock => {
                    const item = document.createElement('div');
                    item.className = 'unlock-item';
                    item.innerHTML = `
                        <span class="unlock-item-name">${unlock.name}</span>
                        <span class="unlock-item-points">${unlock.unlockScore}‚òÖ (noch ${unlock.unlockScore - userScore})</span>
                    `;
                    listDiv.appendChild(item);
                });
            } else {
                nextUnlocksDiv.style.display = 'none';
            }
        }

        // Starte Initialisierung
        init();
    </script>
</body>
</html>
