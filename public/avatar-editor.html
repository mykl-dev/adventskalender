<!DOCTYPE html><!DOCTYPE html>

<html lang="de"><html lang="de">

<head><head>

    <meta charset="UTF-8">    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Avatar Editor - Adventskalender</title>    <title>Avatar Editor - Adventskalender 2024</title>

    <link rel="stylesheet" href="styles.css">    <link rel="stylesheet" href="avatar-editor.css">

    <style>    <style>

        .editor-container {        .avatar-3d-canvas {

            max-width: 1200px;            border-radius: 15px;

            margin: 40px auto;            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);

            padding: 20px;        }

        }        

        .render-mode-toggle {

        .editor-header {            position: absolute;

            text-align: center;            top: 10px;

            margin-bottom: 30px;            right: 10px;

        }            background: rgba(255, 255, 255, 0.1);

            border: 1px solid rgba(255, 255, 255, 0.2);

        .editor-header h1 {            padding: 8px 16px;

            font-size: 2.5rem;            border-radius: 20px;

            margin-bottom: 10px;            cursor: pointer;

            color: var(--primary-color, #c41e3a);            color: white;

        }            font-size: 12px;

            transition: all 0.3s;

        .score-display {            backdrop-filter: blur(10px);

            display: inline-flex;        }

            align-items: center;        

            gap: 10px;        .render-mode-toggle:hover {

            padding: 10px 20px;            background: rgba(255, 255, 255, 0.2);

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            transform: scale(1.05);

            border-radius: 25px;        }

            color: white;    </style>

            font-weight: bold;</head>

            font-size: 1.2rem;<body>

        }    <div class="editor-container">

        <div class="editor-header">

        .editor-layout {            <h1>‚ú® Erstelle deinen Avatar</h1>

            display: grid;            <p class="editor-subtitle">Gestalte deine pers√∂nliche Weihnachtsfigur</p>

            grid-template-columns: 1fr 400px;        </div>

            gap: 30px;

            margin-top: 30px;        <div class="editor-content">

        }            <!-- Avatar Vorschau -->

            <div class="avatar-preview-section" id="avatarPreviewSection">

        @media (max-width: 768px) {                <div class="avatar-preview-card">

            .editor-layout {                    <h2>Dein Avatar</h2>

                grid-template-columns: 1fr;                    <div id="avatarPreview" class="avatar-preview"></div>

            }                </div>

        }            </div>



        .preview-panel {            <!-- Customization Options -->

            background: white;            <div class="customization-section">

            border-radius: 20px;                <!-- Gender Selection -->

            padding: 30px;                <div class="gender-selection">

            box-shadow: 0 10px 30px rgba(0,0,0,0.1);                    <h3>

            position: sticky;                        <span class="category-icon">üé≠</span>

            top: 20px;                        W√§hle deinen Style

            height: fit-content;                    </h3>

        }                    <div class="gender-buttons">

                        <button class="gender-button active" data-gender="babo">

        .preview-avatar {                            <span class="gender-icon">üí™</span>

            width: 100%;                            <span class="gender-label">Babo</span>

            aspect-ratio: 1;                            <span class="gender-desc">Cool & Fresh</span>

            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);                        </button>

            border-radius: 20px;                        <button class="gender-button" data-gender="cutie">

            display: flex;                            <span class="gender-icon">‚ú®</span>

            align-items: center;                            <span class="gender-label">Cutie</span>

            justify-content: center;                            <span class="gender-desc">Cute & Sweet</span>

            margin-bottom: 20px;                        </button>

            overflow: hidden;                    </div>

        }                </div>

                

        .preview-avatar img {                <!-- Username Input -->

            width: 90%;                <div class="input-section">

            height: 90%;                    <label for="usernameInput">

            object-fit: contain;                        <span class="label-icon">üë§</span>

        }                        <span class="label-text">Dein Name</span>

                    </label>

        .save-button {                    <input 

            width: 100%;                        type="text" 

            padding: 15px;                        id="usernameInput" 

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);                        placeholder="Gib deinen Namen ein..." 

            color: white;                        maxlength="20"

            border: none;                        autocomplete="off"

            border-radius: 10px;                    >

            font-size: 1.1rem;                    <span class="char-counter">0/20</span>

            font-weight: bold;                </div>

            cursor: pointer;

            transition: transform 0.2s;                <!-- Kopfbedeckung -->

        }                <div class="customization-category">

                    <h3>

        .save-button:hover {                        <span class="category-icon">üé©</span>

            transform: scale(1.05);                        Kopfbedeckung

        }                    </h3>

                    <div id="headOptions" class="option-grid"></div>

        .options-panel {                </div>

            background: white;

            border-radius: 20px;                <!-- Gesicht -->

            padding: 30px;                <div class="customization-category">

            box-shadow: 0 10px 30px rgba(0,0,0,0.1);                    <h3>

        }                        <span class="category-icon">üòä</span>

                        Gesicht

        .style-grid {                    </h3>

            display: grid;                    <div id="faceOptions" class="option-grid"></div>

            grid-template-columns: repeat(2, 1fr);                </div>

            gap: 15px;

            margin-top: 15px;                <!-- K√∂rper -->

        }                <div class="customization-category">

                    <h3>

        .style-card {                        <span class="category-icon">üëï</span>

            padding: 20px;                        Kleidung

            border: 3px solid #e0e0e0;                    </h3>

            border-radius: 15px;                    <div id="bodyOptions" class="option-grid"></div>

            cursor: pointer;                </div>

            transition: all 0.3s;

            text-align: center;                <!-- F√º√üe -->

            position: relative;                <div class="customization-category">

        }                    <h3>

                        <span class="category-icon">üë¢</span>

        .style-card:hover {                        Schuhe

            border-color: #667eea;                    </h3>

            transform: translateY(-5px);                    <div id="feetOptions" class="option-grid"></div>

        }                </div>

            </div>

        .style-card.active {        </div>

            border-color: #667eea;

            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);        <!-- Action Buttons -->

        }        <div class="editor-actions">

            <button id="randomizeButton" class="btn-secondary">

        .style-card.locked {                üé≤ Zuf√§llig generieren

            opacity: 0.5;            </button>

            cursor: not-allowed;            <button id="saveButton" class="btn-primary">

        }                ‚úÖ Speichern & Loslegen!

            </button>

        .unlock-badge {        </div>

            position: absolute;    </div>

            top: 10px;

            right: 10px;    <!-- Success Modal -->

            background: #ff9800;    <div id="successModal" class="modal">

            color: white;        <div class="modal-content">

            padding: 4px 8px;            <div class="success-icon">üéâ</div>

            border-radius: 10px;            <h2>Avatar erstellt!</h2>

            font-size: 0.8rem;            <p>Dein Avatar wurde erfolgreich gespeichert.</p>

            font-weight: bold;            <div id="finalAvatarPreview" class="final-avatar-preview"></div>

        }            <button id="continueButton" class="btn-primary">

                Zum Adventskalender

        .option-group {            </button>

            margin-bottom: 30px;        </div>

        }    </div>



        .option-group h3 {    <script src="avatarManager.js"></script>

            color: #333;    <script src="avatar3DRenderer.js"></script>

            margin-bottom: 15px;    <script src="avatar-editor.js"></script>

            display: flex;    

            align-items: center;    <script>

            gap: 10px;        // Toggle zwischen 2D und 3D Rendering

        }        const previewCard = document.querySelector('.avatar-preview-card');

        if (previewCard) {

        .locked-badge {            const toggleButton = document.createElement('button');

            background: #ff9800;            toggleButton.className = 'render-mode-toggle';

            color: white;            toggleButton.innerHTML = 'üé® 3D-Modus';

            padding: 4px 12px;            previewCard.style.position = 'relative';

            border-radius: 15px;            previewCard.appendChild(toggleButton);

            font-size: 0.8rem;            

            font-weight: bold;            toggleButton.addEventListener('click', () => {

        }                const editor = window.avatarEditor;

                if (editor) {

        .option-grid {                    editor.use3DRenderer = !editor.use3DRenderer;

            display: grid;                    toggleButton.innerHTML = editor.use3DRenderer ? 'üé® 3D-Modus' : 'üìê 2D-Modus';

            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));                    editor.updatePreview();

            gap: 10px;                }

        }            });

        }

        .option-button {    </script>

            padding: 12px;</body>

            border: 2px solid #e0e0e0;</html>

            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 0.9rem;
        }

        .option-button:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .option-button.active {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
        }

        .option-button.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 5px auto;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .next-unlocks {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
        }

        .unlock-item {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .points-needed {
            background: #ff9800;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="editor-header">
            <h1>üé® Avatar Editor</h1>
            <div class="score-display">
                <span>‚≠ê</span>
                <span id="userScore">0</span>
                <span>Punkte</span>
            </div>
        </div>

        <div class="editor-layout">
            <div class="options-panel">
                <div class="style-selector">
                    <h2>W√§hle deinen Style</h2>
                    <div class="style-grid" id="styleGrid"></div>
                </div>

                <div id="customizationOptions"></div>

                <div class="next-unlocks" id="nextUnlocks" style="display: none;">
                    <h3>üîì N√§chste Freischaltungen</h3>
                    <div id="unlocksList"></div>
                </div>
            </div>

            <div class="preview-panel">
                <div class="preview-avatar">
                    <img src="" alt="Avatar Preview" id="avatarImage">
                </div>
                <div class="preview-info">
                    <h3 id="previewTitle">Dein Avatar</h3>
                    <p id="previewStyle">Adventurer Style</p>
                </div>
                <button class="save-button" onclick="saveAvatar()">üíæ Avatar Speichern</button>
                <button class="save-button" onclick="randomize()" style="margin-top: 10px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">üé≤ Zuf√§llig</button>
            </div>
        </div>
    </div>

    <script src="avatarEditorConfig.js"></script>
    <script>
        let currentStyle = 'adventurer';
        let currentOptions = {
            seed: 'User-' + Date.now(),
            eyes: 'variant01',
            mouth: 'variant01',
            hair: 'short01',
            hairColor: '6a4e35',
            skinColor: 'f2d3b1',
            eyebrows: 'variant01'
        };
        let userScore = 0;

        function loadUserScore() {
            // TODO: Integration mit Stats-System - F√ºr Demo: 150 Punkte
            userScore = 150;
            document.getElementById('userScore').textContent = userScore;
        }

        function init() {
            loadUserScore();
            renderStyleSelector();
            renderCustomizationOptions();
            updatePreview();
            updateNextUnlocks();
        }

        function renderStyleSelector() {
            const grid = document.getElementById('styleGrid');
            const availableStyles = AvatarEditorConfig.getAvailableStyles(userScore);
            const allStyles = Object.values(AvatarEditorConfig.styles);

            grid.innerHTML = allStyles.map(style => {
                const isUnlocked = availableStyles.find(s => s.id === style.id);
                const isActive = style.id === currentStyle;

                return `
                    <div class="style-card ${isActive ? 'active' : ''} ${!isUnlocked ? 'locked' : ''}" 
                         onclick="${isUnlocked ? `selectStyle('${style.id}')` : ''}">
                        ${!isUnlocked ? `<div class="unlock-badge">üîí ${style.unlockScore}‚òÖ</div>` : ''}
                        <h4>${style.name}</h4>
                        <p style="font-size: 0.9rem; color: #666;">${style.description}</p>
                    </div>
                `;
            }).join('');
        }

        function selectStyle(styleId) {
            currentStyle = styleId;
            renderStyleSelector();
            renderCustomizationOptions();
            updatePreview();
            updateNextUnlocks();
        }

        function renderCustomizationOptions() {
            const container = document.getElementById('customizationOptions');
            const available = AvatarEditorConfig.getAvailableOptions(currentStyle, userScore);
            
            let html = '<h2>Anpassungen</h2>';

            for (const [key, option] of Object.entries(available.basic)) {
                html += renderOptionGroup(key, option, false);
            }

            if (Object.keys(available.advanced).length > 0) {
                html += '<h2 style="margin-top: 30px;">üåü Fortgeschritten</h2>';
                for (const [key, option] of Object.entries(available.advanced)) {
                    html += renderOptionGroup(key, option, false);
                }
            }

            container.innerHTML = html;
        }

        function renderOptionGroup(key, option, isLocked) {
            let html = `
                <div class="option-group">
                    <h3>
                        ${option.label}
                        ${isLocked ? `<span class="locked-badge">üîí ${option.unlockScore}‚òÖ</span>` : ''}
                    </h3>
                    <div class="option-grid">
            `;

            option.options.forEach(opt => {
                const isActive = currentOptions[key] === opt.value;
                const disabled = isLocked ? 'disabled' : '';

                if (opt.color) {
                    html += `
                        <div class="option-button ${isActive ? 'active' : ''} ${disabled}" 
                             onclick="${!isLocked ? `selectOption('${key}', '${opt.value}')` : ''}">
                            <div class="color-swatch" style="background: ${opt.color};"></div>
                            <div style="font-size: 0.8rem; margin-top: 5px;">${opt.label}</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="option-button ${isActive ? 'active' : ''} ${disabled}" 
                             onclick="${!isLocked ? `selectOption('${key}', '${opt.value}')` : ''}">
                            ${opt.preview || ''}
                            <div style="font-size: 0.8rem; margin-top: 5px;">${opt.label}</div>
                        </div>
                    `;
                }
            });

            html += `</div></div>`;
            return html;
        }

        function selectOption(key, value) {
            currentOptions[key] = value;
            renderCustomizationOptions();
            updatePreview();
        }

        function updatePreview() {
            const params = new URLSearchParams();
            params.append('seed', currentOptions.seed);
            
            for (const [key, value] of Object.entries(currentOptions)) {
                if (key !== 'seed' && value) {
                    params.append(key, value);
                }
            }

            const avatarUrl = `/api/avatar-custom/${currentStyle}?${params.toString()}`;
            document.getElementById('avatarImage').src = avatarUrl;
            document.getElementById('previewStyle').textContent = 
                AvatarEditorConfig.styles[currentStyle].name;
        }

        function updateNextUnlocks() {
            const nextUnlocks = AvatarEditorConfig.getNextUnlocks(currentStyle, userScore);
            const container = document.getElementById('nextUnlocks');
            const list = document.getElementById('unlocksList');

            if (nextUnlocks.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            list.innerHTML = nextUnlocks.slice(0, 3).map(unlock => `
                <div class="unlock-item">
                    <span>${unlock.label}</span>
                    <span class="points-needed">+${unlock.pointsNeeded}‚òÖ</span>
                </div>
            `).join('');
        }

        function randomize() {
            const available = AvatarEditorConfig.getAvailableOptions(currentStyle, userScore);
            
            for (const [key, option] of Object.entries({...available.basic, ...available.advanced})) {
                if (option.options.length > 0) {
                    const randomIndex = Math.floor(Math.random() * option.options.length);
                    currentOptions[key] = option.options[randomIndex].value;
                }
            }

            renderCustomizationOptions();
            updatePreview();
        }

        function saveAvatar() {
            alert('Avatar gespeichert!');
        }

        init();
    </script>
</body>
</html>
